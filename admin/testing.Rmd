```{r}
# test
```
Average algal group density (based on x number of stations) was x ± y organisms/mL. The most abundant algal groups were cyanobacteria (80% of organisms, μ = 1,595 ± x organisms/mL), diatoms (10% of organisms, μ = x ± y organisms/mL), and green algae (5% of organisms, μ = x ± y organisms/mL). The remaining 5% of organisms were comprised of chrysophytes, cryptophytes, dinoflagellates, euglenoids, haptophytes, and raphidophytes (“Other”, Figure x).


```{r}
PhytoStatsClass <- R6Class(
  'PhytoStatsClass',
  
  public = list(
    df_raw = NULL,
    
    initialize = function(df_raw) {
      self$df_raw <- df_raw
    },
  
  # calc sampling frequency percentage for each AlgalGroup
  calc_alg_per_freq = function(.summ_col = 'per') {
    df_freq <- self$df_raw %>%
      summarize('{.summ_col}' := round(100 * (dplyr::n() / nrow(.)), 2), .by = AlgalGroup) %>%
      arrange(desc(per))
    return(df_freq)
  }
  ),
  
  private = list(
    # define AlgalGroups in either 'Main' or 'Other' category using frequency threshold
    def_alg_cat = function(df, threshold = 5, summ_col = 'per') {
      df_per <- calc_alg_per_freq(df)
      ls_alg <- list(
        main = dplyr::filter(df_per, !!rlang::sym(summ_col) >= threshold) %>% dplyr::pull(AlgalGroup),
        other = dplyr::filter(df_per, !!rlang::sym(summ_col) < threshold) %>% dplyr::pull(AlgalGroup)
      )
      
      return(ls_alg)
    }
  )
)

PhytoStringClass <- R6Class(
  'PhytoStringClass',
  
  inherit = PhytoStatsClass,
  
  public = list(
    df_raw = NULL,
    styling = NULL,
    
    initialize = function(df_raw) {
      self$df_raw <- df_raw
      self$styling <- StylingClass$new()
    },
    
    # create bullet list of algal groups
    alg_list_txt = function() {
      alg_cat <- private$def_alg_cat(self$df_raw, 5)
      
      alg_num <- length(unlist(alg_cat))
      alg_group <- unname(unlist(alg_cat))
    
      # concatenate diatoms
      if (('Pennate Diatoms' %in% alg_group) & ('Centric Diatoms' %in% alg_group)) {
        alg_group <- alg_group[!alg_group %in% c('Pennate Diatoms','Centric Diatoms')]
        alg_group <- c('Diatoms (Pennate and Centric)', alg_group)
      }
      
      alg_group <- sort(alg_group)
    
      alg_list <- self$styling$bullet_list(alg_group)
    
      output <- glue::glue('All organisms collected in {report_year} fell into these {alg_num} algal groups:<br />
                              {alg_list}<br />')
    
      return(output)
    }
  )
)
```

```{r}
stats_phyto_cur$calc_alg_per_freq()

strings_phyto_cur$alg_list_txt()
```


```{r}
# Define AlgalGroups in either "Main or "Other" category using a sampling
  # frequency percentage threshold
def_alg_cat <- function(df, threshold = 5, summ_col = 'per') {
  df_per <- calc_alg_per_freq(df)
  list(
    main = dplyr::filter(df_per, !!rlang::sym(summ_col) >= threshold) %>% dplyr::pull(AlgalGroup),
    other = dplyr::filter(df_per, !!rlang::sym(summ_col) < threshold) %>% dplyr::pull(AlgalGroup)
  )
}

test_x <- def_alg_cat(df_phyto, 5)

test_x
```

```{r}
alg_list_txt <- function(df){
  alg_cat <- def_alg_cat(df, 5)

  alg_num <- length(unlist(alg_cat))
  alg_group <- unname(unlist(alg_cat))

  # concatenate diatoms
  if (('Pennate Diatoms' %in% alg_group) & ('Centric Diatoms' %in% alg_group)){
    alg_group <- alg_group[!alg_group %in% c('Pennate Diatoms','Centric Diatoms')]
    alg_group <- c('Diatoms (Pennate and Centric)', alg_group)
  }

  # sort list
  alg_group <- sort(alg_group)

  # create list
  alg_list <- bullet_list(alg_group)

  output <- glue::glue('All organisms collected in {report_year} fell into these {alg_num} algal groups:<br />
                          {alg_list}<br />')

  return(output)
}

alg_list_txt(df_phyto)
```

